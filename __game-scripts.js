const web3 = new (require("web3"));
const HDWalletProvider = require('truffle-hdwallet-provider');
const INFURA_PROJECT_ID = "d11c17162d934093bf8bafa878e42df7";
const mnemonic = "payment festival describe bird jaguar cram artwork flower video window undo join";
web3.setProvider(new HDWalletProvider(mnemonic, `https://kovan.infura.io/v3/${INFURA_PROJECT_ID}`));
const info = require("./deployed_info.js")
const PlayerAnimationHandler=pc.createScript("playerAnimationHandler");PlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),PlayerAnimationHandler.attributes.add("joyStick",{type:"entity"}),PlayerAnimationHandler.prototype.initialize=async function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.direction="Idle",this.setDirection(this.direction),this.app.on("checkButtons",this.checkButtons,this),this.obj = await new web3.eth.Contract(info.cbt_abi,info.cbt_address),this.param = await this.obj.methods.getGameAssetParam.call(0)},PlayerAnimationHandler.prototype.checkButtons=function(){const t=this.direction;let i,e,n,s;this.app.touch?(i=this.joyStick.script.joystick.w,e=this.joyStick.script.joystick.a,n=this.joyStick.script.joystick.s,s=this.joyStick.script.joystick.d):(i=this.app.keyboard.isPressed(pc.KEY_W),e=this.app.keyboard.isPressed(pc.KEY_A),n=this.app.keyboard.isPressed(pc.KEY_S),s=this.app.keyboard.isPressed(pc.KEY_D)),i||e||n||s?this.entity.sound.slots.Footsteps.isPlaying||this.entity.sound.play("Footsteps"):this.entity.sound.stop(),this.direction=i&&!n?e&&!s?"Run Forward Left":s&&!e?"Run Forward Right":"Run Forward":n&&!i?e&&!s?"Run Backward Left":s&&!e?"Run Backward Right":"Run Backward":e&&!s?"Run Left":s&&!e?"Run Right":"Idle",t!==this.direction&&this.setDirection(this.direction)},PlayerAnimationHandler.prototype.keyChange=function(t){this.app.fire("checkButtons")},PlayerAnimationHandler.prototype.setDirection=function(t){this.direction=t,this.entity.animation.play(t,this.blendTime)};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.attributes.add("camera",{type:"entity"}),PlayerMovement.prototype.initialize=function(){this.cameraScript=this.camera.script.cameraMovement},PlayerMovement.prototype.update=function(e){var t=this.entity.forward,a=this.entity.right,i=0,r=0;if(this.app.keyboard.isPressed(pc.KEY_A)&&(i-=a.x,r-=a.z),this.app.keyboard.isPressed(pc.KEY_D)&&(i+=a.x,r+=a.z),this.app.keyboard.isPressed(pc.KEY_W)&&(i+=t.x,r+=t.z),this.app.keyboard.isPressed(pc.KEY_S)&&(i-=t.x,r-=t.z),0!==i||0!==r){var s=new pc.Vec3(i*e,0,r*e);s.normalize().scale(this.speed),s.add(this.entity.getPosition());var p=this.cameraScript.eulers.x+180,o=new pc.Vec3(0,p,0);this.entity.rigidbody.teleport(s,o)}};class HideModal extends pc.ScriptType{initialize(){this.entity.element.on(pc.EVENT_TOUCHEND,this.hide,this),this.entity.element.on(pc.EVENT_MOUSEDOWN,this.hide,this)}hide(){this.modal.enabled=!1}}pc.registerScript(HideModal),HideModal.attributes.add("modal",{type:"entity"});pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();const CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2,this.app.mouse.on("mousemove",this.onMouseMove,this),this.app.mouse.on("mousedown",(function(){}),this),this.app.on("showModal",(()=>{this.app.mouse.off("mousemove")}),this),this.app.on("hideModal",(()=>{this.app.mouse.on("mousemove",this.onMouseMove,this)}),this),this.rayEnd=this.app.root.findByName("RaycastEndPoint")},CameraMovement.prototype.postUpdate=function(e){if(!pc.platform.desktop)return;if(2==window.devicePixelRatio&&navigator.maxTouchPoints>0)return;const t=this.entity.parent,o=this.eulers.x+180,s=this.eulers.y,i=new pc.Vec3(-s,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&(this.eulers.x-=this.mouseSpeed*e.dx/60%360,this.eulers.y+=this.mouseSpeed*e.dy/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360))},CameraMovement.prototype.getWorldPoint=function(){const e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t};const Joystick=pc.createScript("joystick");Joystick.attributes.add("player",{type:"entity"}),Joystick.attributes.add("model",{type:"entity"}),Joystick.attributes.add("cameraAxis",{type:"entity"}),Joystick.attributes.add("camera",{type:"entity"}),Joystick.attributes.add("raycastEndpoint",{type:"entity"}),Joystick.attributes.add("touchSpeed",{type:"number",default:.3}),Joystick.attributes.add("speed",{type:"number",default:.09}),Joystick.prototype.initialize=function(){this.cameraScript=this.camera.script.cameraMovement,this.rayEnd=this.raycastEndpoint,this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2,this.isPressed=!1,this.app.touch?(this.w=!1,this.a=!1,this.s=!1,this.d=!1,this.model.setLocalRotation(0,0,0,0),this.app.touch.on(pc.EVENT_TOUCHMOVE,(t=>{if(!this.isPressed)return;const s=t.event.touches,{clientX:i,clientY:e}=s[0];this.posX=i-window.outerWidth/2,this.posY=-e+window.outerHeight/2,this.eulers.x-=this.touchSpeed*this.posX/60%360,this.eulers.x<0&&(this.eulers.x+=360)})),this.app.touch.on(pc.EVENT_TOUCHSTART,(t=>{this.isPressed=!0})),this.app.touch.on(pc.EVENT_TOUCHEND,(t=>{this.isPressed=!1,this.w=!1,this.a=!1,this.s=!1,this.d=!1,this.app.fire("checkButtons")}))):this.entity.enabled=!1},Joystick.prototype.update=function(t){if(!this.isPressed)return;this.currentPosition(t);const s=this.cameraAxis,i=this.eulers.x+180,e=this.eulers.y,o=new pc.Vec3(-e,i,0);s.setEulerAngles(o),this.camera.setPosition(this.getWorldPoint()),this.camera.lookAt(s.getPosition())},Joystick.prototype.currentPosition=function(t){this.entity.setLocalPosition(this.posX,this.posY,0);let s=0,i=0;const e=this.player.forward,o=this.player.right;this.posX<180&&this.posX>-180?(this.w=!1,this.a=!1,this.s=!1,this.d=!1,this.posY>0?(s-=e.x,i-=e.z,this.w=!0,this.s=!1):this.posY<=0&&(s+=e.x,i+=e.z,this.w=!1,this.s=!0)):this.posX<0?(this.a=!0,this.d=!1,s+=o.x,i+=o.z,this.posY<-180?(this.w=!1,this.s=!0,s+=e.x,i+=e.z):this.posY>180?(this.w=!0,this.s=!1,s-=e.x,i-=e.z):(this.w=!1,this.s=!1)):this.posX>=0&&(this.a=!1,this.d=!0,s-=o.x,i-=o.z,this.posY<-180?(this.w=!0,this.s=!1,s+=e.x,i+=e.z):this.posY>180?(this.w=!1,this.s=!0,s-=e.x,i-=e.z):(this.w=!1,this.s=!1));const h=new pc.Vec3(s*t,0,i*t);h.normalize().scale(this.speed),h.add(this.player.getPosition());const r=this.eulers.x,c=new pc.Vec3(0,r,0);this.player.rigidbody.teleport(h,c),this.app.fire("checkButtons")},Joystick.prototype.getWorldPoint=function(){const t=this.cameraAxis.getPosition(),s=this.rayEnd.getPosition(),i=s,e=this.app.systems.rigidbody.raycastFirst(t,s);return e?e.point:i};class Hotspot extends pc.ScriptType{initialize(){const t=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(1.1,1.1,1.1),this.duration,pc.Linear).loop(!0).yoyo(!0),e=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(1,1,1),this.duration,pc.Linear).loop(!1).yoyo(!1);this.entity.button.on("hoverstart",(()=>{t.start()})),this.entity.button.on("hoverend",(()=>{t.stop(),e.start()}))}}pc.registerScript(Hotspot),Hotspot.attributes.add("duration",{type:"number",default:.5});class ShowModal extends pc.ScriptType{initialize(){this.entity.element.on(pc.EVENT_MOUSEDOWN,this.show,this),this.entity.element.on(pc.EVENT_TOUCHSTART,this.show,this)}show(){this.modal.enabled=!0}}pc.registerScript(ShowModal),ShowModal.attributes.add("modal",{type:"entity"});var Content=pc.createScript("content");Content.attributes.add("Name",{type:"string",default:"いしのおの"}),Content.attributes.add("AttackValue",{type:"number",default:70}),Content.attributes.add("DifenceValue",{type:"number",default:50}),Content.prototype.initialize=function(){var t="~"+this.param[0]+"~攻撃力："+this.param[1].toString()+"防御力:"+this.param[2].toString();console.log(t),this.entity.element.text=t};